<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<h:head>
    <title>Listagem de Salários</title>
    <h:outputStylesheet library="primefaces" name="primeflex/primeflex.css" />
    <style>
        body {
            font-family: var(--font-family);
            background-color: var(--surface-ground);
            color: var(--text-color);
        }

        .page-card {
            padding: 2rem;
            margin: 2rem auto;
            max-width: 1200px;
            background-color: var(--surface-card);
            border-radius: var(--border-radius);
            box-shadow: var(--surface-shadow);
        }

        .header-table {
            width: 100%;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .p-datatable-responsive table {
            border-collapse: separate;
            border-spacing: 0;
        }

        .p-datatable-header, .p-column-header {
            background-color: var(--surface-ground);
            color: var(--text-color);
            font-weight: 600;
        }

        .recalcular-btn {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: var(--primary-color-text);
        }

        .ui-tag-tecnico {
            background-color: #f3f4f6;
            color: #6b7280;
            font-weight: 600;
        }
    </style>
</h:head>
<h:body>
    <p:sidebar widgetVar="sidebar">
        <h3>ESIG - EDUC<span class="span">21</span></h3>

        <h:panelGrid columns="1" style="width:100%">
            <p:commandButton value="Listagem de Salários"
                             icon="pi pi-table"
                             action="index.xhtml?faces-redirect=true"
                             styleClass="ui-button-flat ui-button-secondary" />
            <p:commandButton value="Logout"
                             icon="pi pi-sign-out"
                             action="pages/login?faces-redirect=true"
                             styleClass="ui-button-flat ui-button-danger" />
        </h:panelGrid>
    </p:sidebar>

    <p:commandButton icon="pi pi-arrow-right" type="button" onclick="PF('sidebar').show()" styleClass="mr-2" />
    <div class="page-card">
        <h:form id="salariosForm">
            <div class="header-table mb-4">
                <p:commandButton value="Recalcular salários"
                                 icon="pi pi-refresh"
                                 action="#{pessoaSalarioConsolidadoBean.recalcularSalarios()}"
                                 update="@form"
                                 styleClass="recalcular-btn ui-button-primary" />

                <p:commandButton value="Baixar relatório"
                                 icon="pi pi-file-pdf"
                                 ajax="false"
                                 onclick="PF('dlg1').show()"
                                 styleClass="ui-button-primary">
                    <p:fileDownload value="#{pessoaSalarioConsolidadoBean.baixarRelatorio()}" />
                </p:commandButton>

                <p:dialog id="dlg1"
                          header="Preparando relatório"
                          widgetVar="dlg1"
                          modal="true"
                          closable="false"
                          draggable="false"
                          resizable="false"
                          minHeight="40" width="350"
                          showEffect="fade" hideEffect="fade">
                    <p class="m-0">Espere um pouco. O relatório está sendo preparado!</p>
                </p:dialog>

                <p:commandButton value="Remover todos salários"
                                 icon="pi pi-trash"
                                 action="#{pessoaSalarioConsolidadoBean.removeTodosSalarios()}"
                                 update="@form"

                                 styleClass="recalcular-btn ui-button-danger" />
            </div>

            <p:dataTable var="p"
                         id="salariosTable"
                         value="#{pessoaSalarioConsolidadoBean.lazyModel}"
                         rows="10"
                         paginator="true"
                         paginatorPosition="bottom"
                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                         currentPageReportTemplate="{startRecord}-{endRecord} de {totalRecords} registros"
                         emptyMessage="Nenhum salário consolidado encontrado."
                         styleClass="p-datatable-responsive p-datatable-striped"
            >
                <p:column headerText="Nome" style="width: 30%;">
                    <h:outputText value="#{p.nome_pessoa}" />
                </p:column>

                <p:column headerText="Cargo" style="width: 20%;">
                    <ui:fragment rendered="#{p.nome_cargo == 'Tecnico'}">
                        <p:tag styleClass="ui-tag-tecnico" value="Técnico" />
                    </ui:fragment>
                    <ui:fragment rendered="#{p.nome_cargo == 'Estagiario'}">
                        <p:tag severity="success" value="Estagiário" />
                    </ui:fragment>
                    <ui:fragment rendered="#{p.nome_cargo == 'Gerente'}">
                        <p:tag severity="info" value="Gerente" />
                    </ui:fragment>
                    <ui:fragment rendered="#{p.nome_cargo == 'Coordenador'}">
                        <p:tag severity="warning" value="Coordenador" />
                    </ui:fragment>
                    <ui:fragment rendered="#{empty p.nome_cargo}">
                        <p:tag severity="secondary" value="Não definido" />
                    </ui:fragment>
                </p:column>

                <p:column headerText="Salário" style="width: 20%; text-align: right;">
                    <h:outputText value="#{p.salario}">
                        <f:convertNumber type="currency" currencySymbol="R$" locale="pt_BR" />
                    </h:outputText>
                </p:column>

                <p:column headerText="Ações" style="text-align:center;">
                    <div style="display: flex; gap: .5rem; justify-content: center;">
                        <p:commandButton icon="pi pi-refresh"
                                         action="#{pessoaSalarioConsolidadoBean.calcularSalarioPessoa(p)}"
                                         update=":salariosForm:salariosTable"
                                         process="@this"
                                         styleClass="ui-button ui-button-info" />

                        <p:commandButton icon="pi pi-trash"
                                         action="#{pessoaSalarioConsolidadoBean.removerSalarioPessoa(p)}"
                                         update=":salariosForm:salariosTable"
                                         process="@this"
                                         styleClass="ui-button ui-button-danger" />
                    </div>
                </p:column>
            </p:dataTable>
        </h:form>
    </div>
</h:body>
</html>